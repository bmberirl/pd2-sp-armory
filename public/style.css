/* ── Reset & Base ──────────────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg-dark: #0a0a0f;
  --bg-panel: #151520;
  --bg-slot: #1a1a2e;
  --bg-slot-hover: #252540;
  --border: #2a2a3e;
  --border-highlight: #4a3a1a;
  --text: #c8c0b0;
  --text-dim: #706858;
  --text-bright: #e8dcc8;
  --gold: #c7a64a;
  --gold-dim: #8a6d2b;
  --red: #cc3333;
  --green: #33cc33;
  --blue: #6969ff;
  --life-red: #8b2020;
  --mana-blue: #20208b;

  /* Item quality colors */
  --q-low: #888888;
  --q-normal: #c8c0b0;
  --q-superior: #c8c0b0;
  --q-magic: #6969ff;
  --q-rare: #ffff00;
  --q-set: #00ff00;
  --q-unique: #c7b377;
  --q-crafted: #ffa500;
  --q-tempered: #ffa500;
  --q-runeword: #c7b377;
}

body {
  background: url('/img/bg.png') no-repeat center center fixed;
  background-size: cover;
  background-color: var(--bg-dark);
  color: var(--text);
  font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  min-height: 100vh;
}

#app {
  max-width: 960px;
  margin: 0 auto;
  padding: 16px;
}

/* ── Header ───────────────────────────────────────────────────────────────── */
#header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  background: linear-gradient(180deg, #1a1520 0%, #0f0f18 100%);
  border: 1px solid var(--border-highlight);
  border-radius: 4px;
  margin-bottom: 12px;
}

#header h1 {
  font-family: 'Cinzel', 'IM Fell English SC', serif;
  font-size: 22px;
  color: var(--gold);
  letter-spacing: 2px;
  text-transform: uppercase;
}

#char-dropdown {
  background: var(--bg-slot);
  color: var(--text-bright);
  border: 1px solid var(--border);
  padding: 6px 12px;
  font-size: 14px;
  border-radius: 3px;
  cursor: pointer;
  min-width: 200px;
}

#char-dropdown:hover { border-color: var(--gold-dim); }
#char-dropdown:focus { outline: none; border-color: var(--gold); }

/* ── Panels ───────────────────────────────────────────────────────────────── */
.panel {
  background: var(--bg-panel);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 16px;
  margin-bottom: 12px;
}

.panel h2 {
  font-family: 'Cinzel', serif;
  font-size: 15px;
  color: var(--gold);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}

/* ── Character Info Bar ───────────────────────────────────────────────────── */
#char-info {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 12px 20px;
  flex-wrap: wrap;
}

.char-name {
  font-family: 'Cinzel', serif;
  font-size: 20px;
  color: var(--gold);
  font-weight: 700;
}

#char-class { color: var(--text-bright); font-size: 15px; }
#char-level { color: var(--text-dim); font-size: 15px; }

#char-flags { margin-left: auto; display: flex; gap: 8px; }
#char-flags .flag {
  padding: 2px 8px;
  border-radius: 3px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.flag-hc { background: #8b2020; color: #ff8888; }
.flag-dead { background: #4a0a0a; color: #ff4444; }
.flag-exp { background: #1a3a1a; color: #88cc88; }

/* ── View Toggle ──────────────────────────────────────────────────────────── */
#view-toggle {
  display: flex;
  gap: 8px;
  padding: 8px 16px;
}

.toggle-btn {
  background: var(--bg-slot);
  color: var(--text-dim);
  border: 1px solid var(--border);
  padding: 6px 16px;
  font-size: 13px;
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.15s;
}

.toggle-btn:hover { border-color: var(--gold-dim); color: var(--text); }
.toggle-btn.active {
  background: var(--gold-dim);
  color: var(--text-bright);
  border-color: var(--gold);
}

/* ── Notice ───────────────────────────────────────────────────────────────── */
.notice {
  background: #1a1820;
  border-color: var(--gold-dim);
  color: var(--text-dim);
  font-size: 13px;
  padding: 10px 16px;
}
.notice code {
  background: var(--bg-slot);
  padding: 1px 5px;
  border-radius: 2px;
  color: var(--text);
}

/* ── Main Content ─────────────────────────────────────────────────────────── */
#main-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  align-items: start;
}

/* ── D2 Inventory Panel ──────────────────────────────────────────────────── */
:root {
  --cell: 44px;
  --slot-bg: rgba(10, 10, 15, 0.7);
  --slot-border: #6a5a2a;
  --slot-border-dim: #3a2a0a;
  --stone-bg: #2d2a24;
}

#paperdoll {
  padding: 0;
  overflow: hidden;
  border-radius: 4px;
}

/* Stone texture background */
.d2-inv {
  background:
    radial-gradient(ellipse at 20% 50%, rgba(60,50,30,0.3) 0%, transparent 70%),
    radial-gradient(ellipse at 80% 50%, rgba(60,50,30,0.3) 0%, transparent 70%),
    radial-gradient(ellipse at 50% 0%, rgba(80,70,50,0.2) 0%, transparent 50%),
    linear-gradient(180deg, #352f26 0%, #2d2a24 30%, #252218 70%, #1e1b16 100%);
  border: 2px solid var(--slot-border);
  box-shadow: inset 0 0 30px rgba(0,0,0,0.5), 0 4px 16px rgba(0,0,0,0.6);
  position: relative;
}

/* Noise overlay for stone texture */
.d2-inv::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.08'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
}

.inv-equip, .inv-grid { position: relative; z-index: 1; }

/* ── Equipment Grid ──────────────────────────────────────────────────────── */
.inv-equip {
  display: grid;
  grid-template-columns: repeat(10, var(--cell));
  grid-template-rows: repeat(7, var(--cell));
  gap: 2px;
  padding: 8px;
  justify-content: center;
}

/* ── Swap Tabs ───────────────────────────────────────────────────────────── */
.swap-tab {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--slot-bg);
  border: 1px solid var(--slot-border-dim);
  color: var(--text-dim);
  font-family: 'Cinzel', serif;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  user-select: none;
}

.swap-tab.active {
  border-color: var(--slot-border);
  color: var(--gold);
  background: rgba(100, 85, 40, 0.25);
}

.stab-l1 { grid-column: 1; grid-row: 1; }
.stab-l2 { grid-column: 2; grid-row: 1; }
.stab-r1 { grid-column: 9; grid-row: 1; }
.stab-r2 { grid-column: 10; grid-row: 1; }

/* ── Equipment Slots ─────────────────────────────────────────────────────── */
.doll-slot {
  background: var(--slot-bg);
  border: 2px solid var(--slot-border);
  box-shadow: inset 0 0 0 1px var(--slot-border-dim);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: default;
  transition: border-color 0.15s, background 0.15s;
  overflow: hidden;
  padding: 2px;
}

.doll-slot:hover {
  border-color: var(--gold);
  background: rgba(100, 85, 40, 0.2);
}

/* Slot grid positions */
.slot-head  { grid-column: 5 / 7;  grid-row: 1 / 3; }
.slot-neck  { grid-column: 7;      grid-row: 2; }
.slot-larm  { grid-column: 1 / 3;  grid-row: 2 / 6; }
.slot-torso { grid-column: 5 / 7;  grid-row: 3 / 6; }
.slot-rarm  { grid-column: 9 / 11; grid-row: 2 / 6; }
.slot-hands { grid-column: 1 / 3;  grid-row: 6 / 8; }
.slot-lring { grid-column: 4;      grid-row: 6; }
.slot-belt  { grid-column: 5 / 7;  grid-row: 6; }
.slot-rring { grid-column: 7;      grid-row: 6; }
.slot-feet  { grid-column: 9 / 11; grid-row: 6 / 8; }

/* Slot content: image fills the slot */
.doll-slot .slot-img {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  display: block;
  image-rendering: pixelated;
}

/* Empty slot dim label */
.doll-slot.empty .slot-label {
  color: var(--text-dim);
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  opacity: 0.5;
}

/* Text fallback for items without images */
.doll-slot .slot-item-name {
  font-size: 10px;
  font-weight: 600;
  line-height: 1.2;
  word-break: break-word;
  text-align: center;
  padding: 2px;
}

/* Quality border colors */
.doll-slot.q-magic { border-color: var(--q-magic); }
.doll-slot.q-rare { border-color: var(--q-rare); }
.doll-slot.q-unique { border-color: var(--q-unique); }
.doll-slot.q-set { border-color: var(--q-set); }
.doll-slot.q-crafted { border-color: var(--q-crafted); }
.doll-slot.q-runeword { border-color: var(--q-runeword); }

/* Quality text colors */
.q-text-low { color: var(--q-low); }
.q-text-normal { color: var(--q-normal); }
.q-text-superior { color: var(--q-superior); }
.q-text-magic { color: var(--q-magic); }
.q-text-rare { color: var(--q-rare); }
.q-text-set { color: var(--q-set); }
.q-text-unique { color: var(--q-unique); }
.q-text-crafted { color: var(--q-crafted); }
.q-text-tempered { color: var(--q-tempered); }
.q-text-runeword { color: var(--q-runeword); }

/* ── Inventory Grid (10x8: rows 1-4 regular, rows 5-8 charms) ────────────── */
.inv-grid {
  display: grid;
  grid-template-columns: repeat(10, var(--cell));
  grid-template-rows: repeat(8, var(--cell));
  gap: 2px;
  padding: 0 8px 8px;
  justify-content: center;
  border-top: 2px solid var(--slot-border-dim);
  margin-top: 2px;
}

.inv-cell {
  background: var(--slot-bg);
  border: 1px solid var(--slot-border-dim);
}

/* Separator between regular inventory (rows 1-4) and charm inventory (rows 5-8) */
.inv-cell.charm-row {
  background: rgba(20, 15, 40, 0.7);
  border-color: #2a2040;
}

/* Inventory item placed in the grid */
.inv-item {
  background: var(--slot-bg);
  border: 1px solid var(--slot-border-dim);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  cursor: default;
  transition: border-color 0.15s;
  z-index: 1;
}

.inv-item:hover {
  border-color: var(--gold);
  z-index: 2;
}

.inv-item img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
}

.inv-item .inv-item-name {
  font-size: 9px;
  font-weight: 600;
  text-align: center;
  word-break: break-word;
  line-height: 1.1;
  padding: 1px;
}

/* Quality border colors for inventory items */
.inv-item.q-magic { border-color: var(--q-magic); }
.inv-item.q-rare { border-color: var(--q-rare); }
.inv-item.q-unique { border-color: var(--q-unique); }
.inv-item.q-set { border-color: var(--q-set); }
.inv-item.q-crafted { border-color: var(--q-crafted); }
.inv-item.q-runeword { border-color: var(--q-runeword); }

/* ── Stats Panel ──────────────────────────────────────────────────────────── */
#right-panels {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.stat-grid { display: flex; flex-direction: column; gap: 6px; }

.stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 3px 0;
}

.stat-label { color: var(--text-dim); font-size: 13px; }
.stat-value { color: var(--text-bright); font-size: 13px; font-weight: 600; font-variant-numeric: tabular-nums; }

.stat-row.life .stat-value { color: #ff6666; }
.stat-row.mana .stat-value { color: #6688ff; }
.stat-row.stamina .stat-value { color: #cccc44; }
.stat-row.gold .stat-value { color: var(--gold); }

.stat-separator {
  height: 1px;
  background: var(--border);
  margin: 8px 0;
}

/* ── Skills Panel ─────────────────────────────────────────────────────────── */
#skills-list {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4px 12px;
}

.skill-entry {
  display: flex;
  justify-content: space-between;
  padding: 3px 6px;
  border-radius: 2px;
  font-size: 12px;
}

.skill-entry:hover { background: var(--bg-slot); }
.skill-name { color: var(--text); display: flex; align-items: center; gap: 4px; }
.skill-icon { width: 24px; height: 24px; object-fit: contain; flex-shrink: 0; }
.skill-points { color: var(--gold); font-weight: 700; min-width: 20px; text-align: right; }

.muted { color: var(--text-dim); font-size: 13px; }

/* ── Item Tooltip ─────────────────────────────────────────────────────────── */
#tooltip {
  position: fixed;
  z-index: 1000;
  background: #0c0c14;
  border: 1px solid #3a3a50;
  border-radius: 3px;
  padding: 10px 14px;
  max-width: 320px;
  min-width: 180px;
  pointer-events: none;
  box-shadow: 0 4px 16px rgba(0,0,0,0.6);
  font-size: 12px;
  line-height: 1.5;
}

.tt-item-img-wrap {
  text-align: center;
  margin-bottom: 6px;
}

.tt-item-img {
  max-height: 64px;
  max-width: 100%;
  object-fit: contain;
}

.tt-name {
  font-size: 14px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 2px;
}

.tt-base {
  text-align: center;
  color: var(--text-dim);
  margin-bottom: 6px;
  font-size: 12px;
}

.tt-separator {
  height: 1px;
  background: #2a2a3e;
  margin: 6px 0;
}

.tt-stat {
  color: var(--text);
  font-size: 12px;
  padding: 1px 0;
}

.tt-stat.magic { color: var(--q-magic); }
.tt-stat.set-bonus { color: var(--q-set); }
.tt-stat.req { color: var(--text-dim); }
.tt-stat.ethereal { color: #8888cc; font-style: italic; }
.tt-stat.socketed { color: #aaaaaa; }

.tt-white { color: #ffffff; }

.tt-socket {
  color: #ccaa44;
  font-size: 11px;
  padding-left: 8px;
}

/* ── WebSocket Status Indicator ───────────────────────────────────────────── */
#ws-status {
  position: fixed;
  bottom: 12px;
  right: 12px;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  transition: background 0.3s;
}

#ws-status.connected { background: #33aa33; }
#ws-status.disconnected { background: #aa3333; }

/* ── Responsive ───────────────────────────────────────────────────────────── */
@media (max-width: 960px) {
  :root { --cell: 38px; }
}

@media (max-width: 768px) {
  :root { --cell: 32px; }

  #main-content {
    grid-template-columns: 1fr;
  }

  #header {
    flex-direction: column;
    gap: 8px;
    text-align: center;
  }

  #char-dropdown { min-width: 100%; }

  #skills-list { grid-template-columns: 1fr; }
}
